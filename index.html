<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>WebAR Solar System</title>

    <!-- Load A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;">

    <button id="startAR" style="padding: 15px 30px; font-size: 16px; cursor: pointer;">
        Start AR Experience
    </button>

    <div id="arContainer" style="display: none; width: 80%; height: 80%;">
        <a-scene embedded arjs="sourceType: webcam;">
            <a-assets>
                <a-asset-item id="solarModel" src="post.glb"></a-asset-item>
            </a-assets>

            <!-- üåå Background with Twinkling Stars -->
            <a-sky id="starrySky" color="black"></a-sky>
            <a-entity id="stars"></a-entity>

            <!-- üåç Solar System Model with Animations & Controls -->
            <a-entity 
                id="solarSystem"
                gltf-model="#solarModel"
                animation-mixer="clip: *; loop: repeat; timeScale: 1"
                position="0 1 -3"
                scale="0.5 0.5 0.5"
                gesture-controls>
            </a-entity>

            <!-- üìå Floating UI Overlay -->
            <a-entity id="info-overlay" position="0 3 -5" scale="1 1 1" visible="false">
                <a-plane width="3" height="1.5" color="white" opacity="0.8">
                    <a-text id="planet-name" value="Planet Name" position="0 0.5 0" color="black" align="center"></a-text>
                    <a-text id="planet-details" value="Details here..." position="0 -0.5 0" color="blue" align="center"></a-text>
                </a-plane>
            </a-entity>

            <!-- üé• Camera Setup with Zoom & Rotate -->
            <a-camera position="0 1.6 2" look-controls>
                <a-cursor></a-cursor>
            </a-camera>
        </a-scene>
    </div>

    <script>
        // üìå Start AR on Button Click
        document.getElementById('startAR').addEventListener('click', async function() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                if (stream) {
                    document.getElementById('startAR').style.display = 'none';
                    document.getElementById('arContainer').style.display = 'block';
                }
            } catch (err) {
                alert("Camera permission denied. Please allow access to use AR.");
            }
        });

        // üé¨ Fix Animations Not Playing
       
        AFRAME.registerComponent("play-all-animations", {
            init: function () {
                let el = this.el;
                
                el.addEventListener("model-loaded", function () {
                    // Ensure animation-mixer component is added
                    if (!el.hasAttribute("animation-mixer")) {
                        el.setAttribute("animation-mixer", "clip: *; loop: repeat; timeScale: 1");
                        console.log("‚úÖ Animation-mixer added and animations should now be playing.");
                    } else {
                        console.log("‚ö† animation-mixer already exists, checking playback...");
                        let mixer = el.components["animation-mixer"];
                        if (mixer) {
                            mixer.play();
                            console.log("‚úÖ Animations started.");
                        } else {
                            console.warn("‚ùå animation-mixer exists but failed to play animations.");
                        }
                    }
                });
            }
        });
    
        document.querySelector("#solarSystem").setAttribute("play-all-animations", "");



        // üñêÔ∏è Enable Zoom & Rotate Controls
        AFRAME.registerComponent('gesture-controls', {
            schema: {
                enabled: { default: true }
            },
            init: function () {
                this.scaleFactor = 1;
                this.el.sceneEl.addEventListener('wheel', (e) => {
                    let scale = this.el.getAttribute("scale");
                    let delta = e.deltaY > 0 ? -0.1 : 0.1;
                    this.el.setAttribute("scale", {
                        x: Math.max(0.1, scale.x + delta),
                        y: Math.max(0.1, scale.y + delta),
                        z: Math.max(0.1, scale.z + delta)
                    });
                });
            }
        });

        // ü™ê Show Info on Tap
        document.querySelector("#solarSystem").addEventListener("click", function() {
            let overlay = document.querySelector("#info-overlay");
            let planetName = document.querySelector("#planet-name");
            let planetDetails = document.querySelector("#planet-details");

            planetName.setAttribute("value", "Sun"); // Example: Change dynamically
            planetDetails.setAttribute("value", "This is the Sun, the center of our solar system.");
            overlay.setAttribute("visible", "true");
        });

        // üåü Add Twinkling Stars Background
        function createStars() {
            let stars = document.getElementById("stars");
            for (let i = 0; i < 200; i++) {
                let star = document.createElement("a-entity");
                let x = (Math.random() - 0.5) * 50;
                let y = (Math.random() - 0.5) * 50;
                let z = (Math.random() - 0.5) * 50;
                star.setAttribute("geometry", "primitive: sphere; radius: 0.05");
                star.setAttribute("material", "color: white; emissive: white; emissiveIntensity: 1");
                star.setAttribute("position", `${x} ${y} ${z}`);
                stars.appendChild(star);
            }
        }
        createStars();
    </script>

</body>
</html>
