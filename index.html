<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>WebAR Solar System</title>

    <!-- Load A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;">

    <button id="startAR" style="padding: 15px 30px; font-size: 16px; cursor: pointer;">
        Start AR Experience
    </button>

    <div id="arContainer" style="display: none; width: 100%; height: 100%;">
        <a-scene embedded arjs="sourceType: webcam;">
            <a-assets>
                <a-asset-item id="solarModel" src="post.glb"></a-asset-item>
            </a-assets>


            <!-- üåç Solar System Model with Animations & Controls -->
            <a-entity 
                id="solarSystem"
                gltf-model="#solarModel"
                animation-mixer="clip: *; loop: repeat; timeScale: 1"
                position="0 1 -3"
                scale="0.5 0.5 0.5"
                interactive-zoom
                gesture-controls>
            </a-entity>

            <a-assets>
                <img id="sunTexture" src="sun2.jpg">
            </a-assets>
            
            <!-- üåû Sun with Glowing Texture -->
            <a-entity id="sun"
                      geometry="primitive: sphere; radius: 1.5"
                      material="src: #sunTexture; transparent: true; shader: standard; emissiveIntensity: 1"
                      position="0 1 -3">
            </a-entity>


            <!-- üé• Camera Setup with Zoom & Rotate -->
            <a-camera position="0 1.6 2" look-controls>
                <a-cursor></a-cursor>
            </a-camera>
        </a-scene>
    </div>

    <script>
        // üìå Start AR on Button Click
        document.getElementById('startAR').addEventListener('click', async function() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                if (stream) {
                    document.getElementById('startAR').style.display = 'none';
                    document.getElementById('arContainer').style.display = 'block';
                }
            } catch (err) {
                alert("Camera permission denied. Please allow access to use AR.");
            }
        });

        // üé¨ Fix Animations Not Playing
       
        AFRAME.registerComponent("play-all-animations", {
            init: function () {
                let el = this.el;
                
                el.addEventListener("model-loaded", function () {
                    // Ensure animation-mixer component is added
                    if (!el.hasAttribute("animation-mixer")) {
                        el.setAttribute("animation-mixer", "clip: *; loop: repeat; timeScale: 1");
                        console.log("‚úÖ Animation-mixer added and animations should now be playing.");
                    } else {
                        console.log("‚ö† animation-mixer already exists, checking playback...");
                        let mixer = el.components["animation-mixer"];
                        if (mixer) {
                            mixer.play();
                            console.log("‚úÖ Animations started.");
                        } else {
                            console.warn("‚ùå animation-mixer exists but failed to play animations.");
                        }
                    }
                });
            }
        });
    
        document.querySelector("#solarSystem").setAttribute("play-all-animations", "");



        // üñêÔ∏è Enable Zoom & Rotate Controls
        AFRAME.registerComponent("planet-interaction", {
            schema: {
                minScale: { type: "vec3", default: { x: 1, y: 1, z: 1 } }, // Original scale
                maxScale: { type: "vec3", default: { x: 1.5, y: 1.5, z: 1.5 } } // Zoomed-in scale
            },
    
            init: function () {
                let el = this.el;
                let originalScale = Object.assign({}, this.data.minScale);
                let zoomedScale = this.data.maxScale;
    
                // üé§ Click to Speak & Zoom
                el.addEventListener("click", function (event) {
                    let clickedPlanet = getPlanetName(el);
                    
                    if (clickedPlanet) {
                        speak(planetDescriptions[clickedPlanet] || "I am a mysterious celestial body.");
                    }
    
                    // üîç Zoom In the Clicked Planet
                    el.setAttribute("scale", zoomedScale);
    
                    // üîÑ Reset Scale after 2 seconds
                    setTimeout(() => {
                        el.setAttribute("scale", originalScale);
                    }, 2000);
                });
    
                // üì± Pinch to Zoom Gesture (Individual Planet)
                let hammer = new Hammer(el.sceneEl.canvas);
                hammer.get("pinch").set({ enable: true });
    
                hammer.on("pinch", (event) => {
                    let scaleFactor = event.scale;
                    let newScale = {
                        x: Math.min(Math.max(originalScale.x * scaleFactor, originalScale.x), zoomedScale.x),
                        y: Math.min(Math.max(originalScale.y * scaleFactor, originalScale.y), zoomedScale.y),
                        z: Math.min(Math.max(originalScale.z * scaleFactor, originalScale.z), zoomedScale.z),
                    };
                    el.setAttribute("scale", newScale);
                });
            }
        });
    
        // üéôÔ∏è Function to Make Planets Speak
        function speak(text) {
            let utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "en-US";
            utterance.rate = 1;
            speechSynthesis.speak(utterance);
        }
    
        // üåç Define Planet Descriptions
        const planetDescriptions = {
            Sun: "I am the Sun, the heart of the Solar System.  I provide light and warmth to all the planets!",
            Mercury: "I am Mercury, the closest planet to the Sun.  I am small but incredibly fast!",
            Venus: "I am Venus, the hottest planet in the solar system, covered with thick clouds!",
            Earth: "Hello! I am Earth, your home planet.  The only planet known to support life.",
            Mars: "I am Mars, also called the Red Planet.  Scientists are searching for signs of life here.",
            Jupiter: "I am Jupiter, the biggest planet in the solar system.  My Great Red Spot is a giant storm!",
            Saturn: "I am Saturn, famous for my beautiful rings made of ice and rock!",
            Uranus: "I am Uranus, I rotate on my side!, and I am a frozen gas giant!",
            Neptune: "I am Neptune, the farthest planet from the Sun.  My winds are the fastest in the Solar System!"
        };
    
        // üîé Function to Detect Clicked Planet
        function getPlanetName(object) {
            while (object) {
                if (planetDescriptions[object.name]) {
                    return object.name; // Return matching planet name
                }
                object = object.parent; // Move up hierarchy if needed
            }
            return null;
        }
    
        // üöÄ Apply Interaction to All Planets Inside the Model
        document.querySelector("#solarSystem").setAttribute("planet-interaction", "");


        


       // // ü™ê Planets Speak on Tap 
       // AFRAME.registerComponent("planet-speech", {
       //      init: function () {
       //          let el = this.el;
       //          el.addEventListener("model-loaded", function () {
       //              let model = el.getObject3D("mesh");
       //              if (!model) return;
        
       //              el.addEventListener("click", function (event) {
       //                  let clickedPlanet = event.detail.intersection.object; // Get clicked object
       //                  let planetName = getPlanetName(clickedPlanet);
                        
       //                  if (planetName) {
       //                      speak(planetDescriptions[planetName] || "I am a mysterious celestial body.");
       //                  }
       //              });
       //          });
       //      }
       //  });
        
       //  // üéôÔ∏è Function to make planets speak
       //  function speak(text) {
       //      let utterance = new SpeechSynthesisUtterance(text);
       //      utterance.lang = "en-US"; // Set language
       //      utterance.rate = 1; // Adjust speed
       //      speechSynthesis.speak(utterance);
       //  }
        
       //  // üåç Define planet descriptions
       //  const planetDescriptions = {
       //      Sun: "I am the Sun, the heart of the Solar System. I provide light and warmth to all the planets!. My gravity keeps the planets in orbit!.I have been shining for over 4.6 billion years! My surface temperature is around 5,500¬∞C",
       //      Mercury: "I am Mercury, the closest planet to the Sun. I am small but incredibly fast!",
       //      Venus: "I am Venus, the hottest planet in the solar system, covered with thick clouds!.",
       //      Earth: "Hello! I am Earth, your home planet. The only planet known to support life.",
       //      Mars: "I am Mars, also called the Red Planet. Scientists are searching for signs of life here.",
       //      Jupiter: "I am Jupiter, the biggest planet in the solar system. My Great Red Spot is a giant storm!",
       //      Saturn: "I am Saturn, famous for my beautiful rings made of ice and rock!.",
       //      Uranus: "I am Uranus, I rotate on my side!, and I am a frozen gas giant!",
       //      Neptune: "I am Neptune, the farthest planet from the Sun. My winds are the fastest in the Solar System!"
       //  };
        
       //  // üîé Function to get the planet name from the clicked object
       //  function getPlanetName(object) {
       //      while (object) {
       //          if (planetDescriptions[object.name]) {
       //              return object.name; // Return matching planet name
       //          }
       //          object = object.parent; // Move up hierarchy if needed
       //      }
       //      return null;
       //  }
        
       //  // üî• Attach the component to the solar system model
       //  document.querySelector("#solarSystem").setAttribute("planet-speech", "");


    </script>

</body>
</html>
