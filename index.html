<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>WebAR Solar System</title>

    <!-- A-Frame & AR.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
    <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
</head>

<body style="margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;">
    <button id="startAR" style="padding: 15px 30px; font-size: 16px; cursor: pointer;">
        Start AR Experience
    </button>

    <div id="arContainer" style="display: none; width: 100%; height: 100%;">
        <a-scene embedded arjs="sourceType: webcam;">
            <!-- Assets -->
            <a-assets>
                <a-asset-item id="solarModel" src="post.glb"></a-asset-item>
                <a-asset-item id="galaxyModel" src="galaxy.glb"></a-asset-item>
                <a-asset-item id="blackHoleModel" src="blackhole.glb"></a-asset-item> <!-- Black Hole Model -->
                <img id="sunTexture" src="sun2.jpg">
            </a-assets>

            <!-- Asteroid Flash Animation -->
            <a-entity id="asteroid" geometry="primitive: sphere; radius: 1.5" 
                      position="0 5 -10" material="color: gray; emissive: #555; emissiveIntensity: 0.8"
                      animation="property: material.emissiveIntensity; to: 1; dur: 300; loop: true"></a-entity>

            <!-- Galaxy Intro -->
            <a-entity id="galaxyIntro"
                      gltf-model="#galaxyModel"
                      position="0 2 -10"
                      scale="5 5 5"
                      visible="false"
                      animation="property: rotation; to: 0 360 0; loop: true; dur: 8000">
            </a-entity>

            <!-- Black Hole -->
            <a-entity id="blackHole"
                      gltf-model="#blackHoleModel"
                      position="0 2 -10"
                      scale="5 5 5"
                      visible="false"
                      animation="property: scale; to: 0 0 0; dur: 0; autoplay: false">
            </a-entity>

            <!-- Solar System (hidden initially) -->
            <a-entity id="solarSystem"
                      gltf-model="#solarModel"
                      animation-mixer
                      position="0 2 -30"
                      scale="0.5 0.5 0.5"
                      visible="false"
                      gesture-controls">
            </a-entity>

            <!-- Glowing Sun -->
            <a-entity id="sun"
                      geometry="primitive: sphere; radius: 1.2"
                      material="src: #sunTexture; shader: standard; emissiveIntensity: 1"
                      position="0 2 -30"
                      visible="false">
            </a-entity>

            <!-- Camera -->
            <a-camera id="mainCamera" position="1 5 15" rotation="-30 -45 0" look-controls>
                <a-cursor></a-cursor>
            </a-camera>
        </a-scene>
    </div>

    <script>
        // Intro voice narration with callback
        function introSpeak(text, callback) {
            let utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = "en-US";
            utterance.rate = 1;
            utterance.onend = callback;
            speechSynthesis.speak(utterance);
        }
        // AR Start Flow
        document.getElementById('startAR').addEventListener('click', async function () {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                if (stream) {
                    document.getElementById('startAR').style.display = 'none';
                    document.getElementById('arContainer').style.display = 'block';

                    const galaxy = document.querySelector("#galaxyIntro");
                    const blackHole = document.querySelector("#blackHole");
                    const solar = document.querySelector("#solarSystem");
                    const sun = document.querySelector("#sun");
                    const camera = document.querySelector("#mainCamera");
                    const asteroid = document.querySelector("#asteroid");

                    // Step 1: Asteroid flashes
                    asteroid.setAttribute("animation", {
                        property: "material.emissiveIntensity",
                        to: 0.8,
                        dur: 300,
                        loop: true
                    });

                    setTimeout(() => {
                        asteroid.setAttribute("animation", {
                            property: "material.emissiveIntensity",
                            to: 0,
                            dur: 300,
                            loop: false
                        });

                        // Step 2: Show Galaxy
                        galaxy.setAttribute("visible", "true");

                        // Narration
                        introSpeak("Welcome, traveler of the stars… You are entering the Chronicles of the Celestial Classroom. Before you stands the vast spiral galaxy, home to countless wonders. Now… let us journey to a very special corner of this galaxy — our own Solar System. First, observe the cosmic force that is a black hole, and then behold the galaxy fade, giving way to the solar system!", () => {

                            // Step 3: Show Black Hole
                            blackHole.setAttribute("visible", "true");
                            blackHole.setAttribute("animation", {
                                property: "scale",
                                to: "5 5 5",
                                dur: 5000,
                                easing: "easeInOutQuad",
                                autoplay: true
                            });

                            // Hide galaxy after black hole animation
                            setTimeout(() => {
                                galaxy.setAttribute("visible", "false");

                                // Step 4: Zoom in camera to solar system
                                camera.setAttribute("animation", {
                                    property: "position",
                                    to: "0 2 10",
                                    dur: 8000,
                                    easing: "easeInOutQuad"
                                });

                                // Hide black hole and show solar system & sun
                                blackHole.setAttribute("visible", "false");
                                solar.setAttribute("visible", "true");
                                sun.setAttribute("visible", "true");
                                speak("I am the Sun, the heart of the Solar System. I provide light and warmth to all the planets. My gravity keeps them in orbit. I've been shining for over 4.6 billion years!");
                            }, 5000); // After 5 seconds, fade out black hole and start solar system transition
                        });
                    }, 2000); // Wait 2 seconds before flashing the asteroid

                }
            } catch (err) {
                alert("Camera permission denied. Please allow access to use AR.");
            }
        });
    </script>
</body>
</html>
